<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>[C] 每天來點字串用法 (7) － strtok - skyblog</title>

  <link rel="apple-touch-icon" sizes="180x180" href="/static/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon-16x16.png">
  <link rel="manifest" href="/static/site.webmanifest">
  <link rel="mask-icon" href="/static/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">

  <link rel="stylesheet" href="/static/style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com"/>
  <link
    href="https://fonts.googleapis.com/css2?family=Maven+Pro:wght@400;500;600;700&display=swap"
    rel="stylesheet"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap"
    rel="stylesheet"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@700&display=swap"
    rel="stylesheet"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Exo+2:wght@600&display=swap"
    rel="stylesheet"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Ubuntu+Mono:ital@0;1&display=swap"
    rel="stylesheet"
  />
  <link href="https://fonts.googleapis.com/css2?family=Kalam&display=swap" rel="stylesheet">
  <link
    rel="stylesheet"
    href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"
    integrity="sha384-vSIIfh2YWi9wW0r9iZe7RJPrKwp6bG+s9QZMoITbCckVJqGCCRhc+ccxNcdpHuYu"
    crossorigin="anonymous"
  />

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-266M1NLNKL"></script>
  <script>
      window.dataLayer = window.dataLayer || [];

      function gtag() {
          dataLayer.push(arguments);
      }

      gtag('js', new Date());

      gtag('config', 'G-266M1NLNKL');
  </script>
  
  <link
    rel="stylesheet"
    href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/atom-one-light.min.css"
  />

</head>



<body class="postpage">
<header>
  <nav>
    <ul>
      <li class="brand">
        <a href="/"><i class="fas fa-feather"></i> skyblog</a>
      </li>
      
        <li class="option">
          <a href="/">Home</a>
        </li>
      
        <li class="option">
          <a href="/articles/">Articles</a>
        </li>
      
        <li class="option">
          <a href="/portfolio/">Portfolio</a>
        </li>
      
        <li class="option">
          <a href="/#about">About</a>
        </li>
      
      <li id="toggle-navbar"><i class="fas fa-th-large"></i></li>
    </ul>
  </nav>
</header>

<section class="banner">
  
</section>


  
  <section class="toc-wrapper hidden" id="toc">
    <ul class="toc">
      
        
          <li><a href="#strtok-zi-chuan-fen-ge-0"><code>strtok</code>：字串分割</a></li>
        
      
    </ul>
  </section>

  <main>
    <article>
      
  
  <section class="info">
    <h1 class="title"><i class="fas fa-seedling"></i><span>[C] 每天來點字串用法 (7) － strtok</span></h1>
    <div class="meta-data">
      <span class="author"><i class="fas fa-feather-alt"></i> Sky</span>
      <time class="publish-date">
        <i class="fas fa-at"></i> 2025 - 02 - 15
      </time>
    </div>
  </section>


  <div class="article-wrapper">
    <section class="post-content">
      <p>想不到吧，這個部落格居然還活著，而且還會填坑。</p>
<p>原本以為常用的字串函式都介紹得差不多了，直到最近工作時看到 <code>strtok</code> 才想到，好像還沒介紹過他。</p>
<h1 id="strtok-zi-chuan-fen-ge-0"><code>strtok</code>：字串分割</h1><p>所屬標頭檔：<code>&lt;string.h&gt;</code><br>
函式宣告：</p>
<pre><code class="language-c">char* strtok( char* restrict str, const char* restrict delim );</code></pre>
<p><code>strtok</code> 的功能是將字串分成一個個的 <strong>token</strong>，也就是字串片段。聽起來好像很簡單，不過 <code>strtok</code> 的運作方式可能會讓人有點意外。</p>
<p>先說明參數的部分：第一個參數 <code>str</code> 是要被分割的字串，而第二個 <code>delim</code> 則表示要以哪些字元來分割字串，在 <code>delim</code> 裡的所有字元皆會被用於分割 <code>str</code>。</p>
<p>接著來看看 <code>strtok</code> 的使用方式，<code>strtok</code> 的呼叫分為兩種類型：<strong>初次呼叫</strong>及<strong>後續呼叫</strong>。</p>
<ol>
<li><p><strong>初次呼叫</strong>：以<strong>非 <code>NULL</code></strong> 的字串 <code>str</code> 呼叫 <code>strtok(str, delim)</code>，<code>strtok</code> 會將 <code>str</code> 中第一個遇到的分隔字元替換為 <code>\0</code>，也就是進行<strong>分割</strong>，然後回傳此 token 的指標。</p>
</li>
<li><p><strong>後續呼叫</strong>：在初次呼叫之後，我們要改用 <strong><code>NULL</code></strong> 來呼叫 <code>strtok</code>，也就是 <code>strtok(NULL, delim)</code>。這種情況下，<code>strtok</code> 會從上次分割的地方繼續，尋找下一個分隔字元並進行分割，最後將新找到的 token 回傳。</p>
</li>
</ol>
<p>當 <code>strtok</code> 找不到下一個 token，例如已經到底（<code>\0</code>）或字串剩下的部分都是分隔字元，則會回傳 <code>NULL</code>。</p>
<p>不過為什麼只傳入 <code>NULL</code>，<code>strtok</code> 就會知道要從哪裡繼續呢？其實 <code>strtok</code> 函式使用了<a href="https://github.com/bminor/glibc/blob/1b6f868625403d6b7683af840e87d2b18d5d7731/string/strtok.c#L33">靜態（<code>static</code>）變數</a>來儲存上次分割處的下一個位址，以利在後續呼叫時使用。</p>
<div class="admonition admonition-tip"><p>每次 <code>strtok</code> 都會修改這個靜態變數，導致這個函式並不是<strong>執行緒安全（thread-safe）</strong>的。</p></div><p>來看看具體的使用範例：</p>
<pre><code class="language-c=">#include &lt;stdio.h&gt;
#include &lt;string.h&gt;

int main(void) {
    char str[32] = &quot;hello world foo bar span&quot;;

    char *token;
    token = strtok(str, &quot; &quot;);
    while (token) {
        printf(&quot;%s\n&quot;, token);
        token = strtok(NULL, &quot; &quot;);
    }

    return 0;
}</code></pre>
<p>細心的讀者們可能會想到，要是字串開頭就是分隔字元會發生什麼事呢？這時候 <code>strtok</code> 會一路向後尋找第一個不是分隔字元的字元，並當作此次 token 的起始位置，若找不到則回傳 <code>NULL</code>。</p>
<p>另外，若 <code>str</code> 或 <code>delim</code> 不是以 <code>\0</code> 結尾的字串，就會造成 Undefined behavior。</p>
<p>最後再來看同時有多個分隔字元的例子：</p>
<pre><code class="language-c=">#include &lt;ctype.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;

int main(void) {
    char str[512] =  // Note: this paragraph is generated by ChatGPT
        &quot;The deep sea remains one of the most mysterious places on Earth, with vast areas still unexplored by humans. Strange &quot;
        &quot;creatures, like bioluminescent fish and giant squid, thrive in its cold, dark depths. Scientists believe that &quot;
        &quot;studying these extreme environments could help us understand life on other planets. As technology advances, we may &quot;
        &quot;one day uncover the secrets hidden in the ocean&#x27;s abyss.&quot;;

    char *sentence;
    sentence = strtok(str, &quot;,.&quot;);  // split by , or .
    while (sentence) {
        while (isspace(sentence[0])) {  // Skip spaces if any
            sentence++;
        }
        printf(&quot;%s\n&quot;, sentence);
        sentence = strtok(NULL, &quot;,.&quot;);
    }

    return 0;
}</code></pre>
<hr>
<p>參考資料：</p>
<ol>
<li><a href="https://en.cppreference.com/w/c/string/byte/strtok">cppreference - strtok</a></li>
<li><a href="https://sourceware.org/git/?p=glibc.git;a=blob;f=string/strtok.c;h=d0c69afc1ff0e5aad1913870afdcb425865e1921;hb=HEAD">glibc 中 strtok 的實作</a>、<a href="https://github.com/bminor/glibc/blob/master/string/strtok.c">GitHub 上非官方的 mirror</a></li>
<li>我休息了好幾年的腦袋</li>
</ol>
<p>後記：<br>
　　好久不見，這幾年經歷的事實在是太多了，去年更是從年頭忙到年尾。雖然發了篇新文，但也不代表之後會固定更新就是ㄌ<br>
　　其實是看到 Google 搜尋後台的報告中，點閱數逐漸下滑，才在想是不是該來救一下的，不過大概也不是發幾篇文就能救得起來XD</p>

    </section>
    
  
    <ul class="tags">
      <li>
          <a href="/articles/tag/C/">
            C
          </a>
        </li>
      <li>
          <a href="/articles/tag/C-Zi-Chuan/">
            C - 字串
          </a>
        </li>
      
    </ul>
  

    <div class="comments">
<div id="disqus_thread"></div>
<script>
  var disqus_config = function() { this.page.identifier = "/articles/c-str-7"; this.page.url = "https://25349023.github.io/articles/2025-02/c-str-7/"; };
  (function() {
    var d = document, s = d.createElement('script');
    s.src = '//lecielblog.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>
  Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript"
    rel="nofollow">comments powered by Disqus.</a>
</noscript>
</div>
    
  
  <section class="adjacent-posts">
    
    
      <div class="prev">
        <span>Prev Post</span>
        <a href="/articles/2023-01/imawoikirunoda-saucydog/">
          <h3><i class="fas fa-chevron-left"></i> [歌詞翻譯] 現在を生きるのだ。 － Saucy Dog</h3>
        </a>
      </div>
    
  </section>

  </div>

    </article>
  </main>

  <figure class="modal hidden" id="modal">
    <img src="" alt=""/>
    <figcaption>Alt text</figcaption>
  </figure>

  <div class="overlay hidden" id="overlay"></div>
  <aside class="hidden" id="sidebar">
    <div class="blur"></div>
    <div class="content">
      <div class="profile-image"></div>
      <div class="name">天ほし</div>
      <nav>
        <ul>
          <li class="collapsible-category" id="root-collapsible">
            <a>Category <i class="fas fa-angle-down"></i></a>
            
  
  <ul>
    
    
      

      
      
        <li class="collapsible-category">
          <a>C <i class="fas fa-angle-down"></i></a>
          <ul>
      
        <li><a href="/articles/tag/C/"
        >All</a></li>
      

      
      
        <li><a href="/articles/tag/C-Zi-Chuan/"
        >字串</a></li>
      
      
    </ul>
        </li>
      
      
    
      

      
      
        <li><a href="/articles/tag/Cpp/"
        >C++</a></li>
      
      
    
      

      
      
        <li class="collapsible-category">
          <a>Python <i class="fas fa-angle-down"></i></a>
          <ul>
      
        <li><a href="/articles/tag/Python/"
        >All</a></li>
      

      
      
        <li><a href="/articles/tag/Python-Structural-Pattern-Matching/"
        >Structural Pattern Matching</a></li>
      
      
    </ul>
        </li>
      
      
    
      

      
      
        <li class="collapsible-category">
          <a>演算法 <i class="fas fa-angle-down"></i></a>
          <ul>
      
        <li><a href="/articles/tag/Yan-Suan-Fa/"
        >All</a></li>
      

      
      
        <li><a href="/articles/tag/Yan-Suan-Fa-Sou-Xun/"
        >搜尋</a></li>
      
      
    </ul>
        </li>
      
      
    
      

      
      
        <li class="collapsible-category">
          <a>歌詞翻譯 <i class="fas fa-angle-down"></i></a>
          <ul>
      
        <li><a href="/articles/tag/Ge-Ci-Fan-Yi/"
        >All</a></li>
      

      
      
        <li><a href="/articles/tag/Ge-Ci-Fan-Yi-Ri-Wen/"
        >日文</a></li>
      
      
    </ul>
        </li>
      
      
    
      

      
      
        <li class="collapsible-category">
          <a>日常 <i class="fas fa-angle-down"></i></a>
          <ul>
      
        <li><a href="/articles/tag/Ri-Chang/"
        >All</a></li>
      

      
      
        <li><a href="/articles/tag/Ri-Chang-Duan-Tan/"
        >短談</a></li>
      
      
    </ul>
        </li>
      
      
    
      

      
      
        <li><a href="/articles/tag/Test/"
        >Test</a></li>
      
      
    
  </ul>

          </li>
          <li>
            <a href="mailto:25349023.qq@gmail.com">Contact Me</a>
          </li>
          <li>
            <a href="https://github.com/25349023/"><i class="fab fa-github"></i> GitHub</a>
          </li>
        </ul>
      </nav>
    </div>
    <button class="handle"><i class="fas fa-bars"></i></button>
  </aside>


<a href="#" class="scroll-top hidden" id="scroll-top">
  <i class="fas fa-chevron-up"></i>
</a>
<footer>&copy; Copyright 2021 by Skyline Liu.</footer>
<script src="/static/js/scroll_top.js"></script>
<script src="/static/js/navbar.js"></script>

  
  <script src="/static/js/sidebar.js"></script>
  <script src="/static/js/category.js"></script>

  <script src="/static/js/line_numbers.js"></script>
  <script src="/static/js/toc.js"></script>
  <script src="/static/js/post_image.js"></script>
  <script src="/static/js/modal.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script>
      hljs.initHighlightingOnLoad();
  </script>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

</body>
</html>
